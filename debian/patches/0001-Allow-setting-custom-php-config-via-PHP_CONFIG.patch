From: =?utf-8?q?Ond=C5=99ej_Sur=C3=BD?= <ondrej@sury.org>
Date: Tue, 7 Jun 2016 09:46:44 +0200
Subject: Allow setting custom php-config via PHP_CONFIG

---
 php/config/Make.rules.php | 11 ++++++++---
 php/src/Makefile          |  2 +-
 php/src/php5/Makefile     |  2 +-
 php/src/php7/Makefile     |  2 +-
 4 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/php/config/Make.rules.php b/php/config/Make.rules.php
index 1176ccd..ec40d7b 100644
--- a/php/config/Make.rules.php
+++ b/php/config/Make.rules.php
@@ -52,6 +52,11 @@ embedded_runpath 	?= yes
 #
 #USE_NAMESPACES          ?= yes
 
+#
+# Use specific PHP version
+#
+PHP_CONFIG		?= php-config
+
 # ----------------------------------------------------------------------
 # Don't change anything below this line!
 # ----------------------------------------------------------------------
@@ -63,8 +68,8 @@ ice_language     = php
 ice_require_cpp  = yes
 slice_translator = slice2php
 
-ifeq ($(shell php-config --libs /dev/null && echo 0),0)
-    $(error php-config not found review your PHP installation and ensure php-config is in your PATH)
+ifeq ($(shell $(PHP_CONFIG) --libs /dev/null && echo 0),0)
+    $(error $(PHP_CONFIG) not found review your PHP installation and ensure $(PHP_CONFIG) is in your PATH)
 endif
 
 ifeq ($(shell test -f $(top_srcdir)/config/Make.common.rules && echo 0),0)
@@ -80,7 +85,7 @@ ifndef usr_dir_install
     install_libdir  	= $(prefix)/php
 else
     install_phpdir  	= $(prefix)/share/php
-    install_libdir  	= $(shell php -r "echo(ini_get('extension_dir'));")
+    install_libdir  	= $(shell $(PHP_CONFIG) --extension-dir)
 endif
 
 ifdef ice_src_dist
diff --git a/php/src/Makefile b/php/src/Makefile
index f93f1c9..855f567 100644
--- a/php/src/Makefile
+++ b/php/src/Makefile
@@ -12,7 +12,7 @@ top_srcdir	= ..
 include $(top_srcdir)/config/Make.rules.php
 
 
-ifeq ($(shell [ $$(php-config --vernum) -lt 70000 ] && echo true),true)
+ifeq ($(shell [ $$($(PHP_CONFIG) --vernum) -lt 70000 ] && echo true),true)
 SUBDIRS		= php5
 else
 SUBDIRS		= php7
diff --git a/php/src/php5/Makefile b/php/src/php5/Makefile
index 8f1f7fe..e240186 100644
--- a/php/src/php5/Makefile
+++ b/php/src/php5/Makefile
@@ -27,7 +27,7 @@ OBJS		= Communicator.o \
 
 include $(top_srcdir)/config/Make.rules.php
 
-CPPFLAGS	:= -I. $(CPPFLAGS) $(ICE_FLAGS) $(shell php-config --includes)
+CPPFLAGS	:= -I. $(CPPFLAGS) $(ICE_FLAGS) $(shell $(PHP_CONFIG) --includes)
 
 LINKWITH        := $(ICE_LIBS) $(CXXLIBS)
 
diff --git a/php/src/php7/Makefile b/php/src/php7/Makefile
index 8f1f7fe..e240186 100644
--- a/php/src/php7/Makefile
+++ b/php/src/php7/Makefile
@@ -27,7 +27,7 @@ OBJS		= Communicator.o \
 
 include $(top_srcdir)/config/Make.rules.php
 
-CPPFLAGS	:= -I. $(CPPFLAGS) $(ICE_FLAGS) $(shell php-config --includes)
+CPPFLAGS	:= -I. $(CPPFLAGS) $(ICE_FLAGS) $(shell $(PHP_CONFIG) --includes)
 
 LINKWITH        := $(ICE_LIBS) $(CXXLIBS)
 
